{% from 'macros.html' import capcode_author, thread_stats, get_image_src %}


{% if post.resto == 0 and not search_result%}
    {{ thread_stats(post) }}
    <div class="postContainer opContainer" id="pc{{post.no}}">
{% else %}
    <div class="postContainer replyContainer" id="pc{{post.no}}">
    <div class="sideArrows" id="sa{{post.no}}">&gt;&gt;</div>
{% endif %}


{% if post.resto == 0 and not search_result %}
    <div id="p{{post.no}}" class="post op reply">
{% else %}
    <div id="p{{post.no}}" class="post reply">
{% endif %}

<div class="postInfoM mobile" id="pim{{post.no}}">
    {% if post.sub %}
        <span class="subject">{{post.sub}}</span>
    {% endif %}
    <span class="nameBlock">
        <span class="name">{{post.name}}</span>
        <br>
    </span>
    <span class="dateTime postNum" data-utc="{{post.time}}">
        {{post.now}}
        <a href="#{{post.num}}" title="Link to this post">No. {{post.no}}</a>
    </span>
</div>
{% if post.resto == 0 and post.filename %}
    <div class="file" id="f{{post.no}}">
        <div class="fileText" id="fT{{post.no}}">
            File:
            <a href="{{ get_image_src(post.board_shortname, post, thumb_uri, image_uri, prefer='image') }}">{{post.filename}}.{{post.ext}}</a>
            (<span title="{{post.md5}}">{% if post.spoiler %}Spoiler, {% endif %}{% if post.fsize >= 1048576 %}{{(post.fsize / 1024 / 1024 )| round(2, 'floor')}} MB, {{post.w}}x{{post.h}}){% else %}{{(post.fsize / 1024 )| round(1, 'floor')}} KB, {{post.w}}x{{post.h}}){% endif %}</span>
            {% if search_result %}
                Replies: {{post.replies}} Files: {{post.images}} {% if post.posters %}Posters: {{post.posters}}{% endif %}
            {% endif %}
        </div>
        <a class="fileThumb" href="{{ get_image_src(post.board_shortname, post, thumb_uri, image_uri, prefer='image') }}" target="_blank">
            <img src="{{ get_image_src(post.board_shortname, post, thumb_uri, image_uri) }}" data-md5="{{post.md5}}" style="height: {{post.tn_h}}px; width: {{post.tn_w}}px;" class="opImg postImg{% if post.spoiler %} spoiler{% endif %}" loading="lazy">
        </a>
    </div>
{% endif %}
<div class="postInfo desktop" id="pi{{post.no}}">
    {% if search_result %}
        <b>/{{post.board_shortname}}/</b>
    {% endif %}
    {% if search_result and post.resto == 0 %}
        <strong style="color: #4da57c;">OP</strong>
    {% endif %}
    {% if post.filedeleted and not post.deleted_time %}
        <strong class="warning" title="This post was prematurely deleted.">[Deleted]</strong>
    {% endif %}
    {% if post.filedeleted and post.deleted_time %}
        <strong class="warning" title="This post was deleted on {{post.deleted_time}}.">[Deleted]</strong>
    {% endif %}
    {% if post.sub %}
        <span class="subject">{{post.sub}}</span>
    {% endif %}
    <span class="nameBlock {{ capcode_author(post.capcode) }}">
        {% if post.email and post.email != 'noko' %}<a href="mailto:{{ post.email }}">{% endif %}<span class="name{% if post.capcode %} capcode{% endif %}"{% if post.exif %} title="Exif: {{post.exif}}"{% endif %}>{{ post.name }}</span>{% if post.trip %}<span class="postertrip">{{ post.trip }}</span>{% endif %}{% if post.email and post.email != 'noko' %}</a>{% endif %}

        {% if post.capcode and post.capcode != 'A' and post.capcode != 'F' and post.capcode != 'M' and post.capcode != 'D' and post.capcode != 'G' and post.capcode != 'V' %}<strong class="capcode hand id_unknown" title="Highlight posts by Unknown Capcode">## {{post.capcode}}</strong>{% endif %}{% if post.capcode == 'A' %}<strong class="capcode hand id_admin" title="Highlight posts by Administrators">## Admin</strong> <img src="/static/images/adminicon.gif" alt="Admin Icon" title="This user is a 4chan Administrator." class="identityIcon retina">{% endif %}{% if post.capcode == 'F' %}<strong class="capcode hand id_founder" title="Highlight posts by the Founder">## Founder</strong> <img src="/static/images/foundericon.gif" alt="Founder Icon" title="This user is the 4chan Founder." class="identityIcon retina">{% endif %}{% if post.capcode == 'M' %}<strong class="capcode hand id_moderator" title="Highlight posts by Moderators">## Mod</strong> <img src="/static/images/modicon.gif" alt="Mod Icon" title="This user is a 4chan Moderator." class="identityIcon retina">{% endif %}{% if post.capcode == 'D' %}<strong class="capcode hand id_developer" title="Highlight posts by Developers">## Developer</strong> <img src="/static/images/developericon.gif" alt="Developer Icon" title="This user is a 4chan Developer." class="identityIcon retina">{% endif %}{% if post.capcode == 'G' %}<strong class="capcode hand id_manager" title="Highlight posts by Managers">## Manager</strong> <img src="/static/images/managericon.gif" alt="Manager Icon" title="This user is a 4chan Manager." class="identityIcon retina">{% endif %}{% if post.capcode == 'V' %}<strong class="capcode hand id_verified" title="Highlight posts by Verified Users">## Verified</strong>{% endif %}
    </span>
    {% if post.since4pass %}<span class="n-pu" title="Pass user since {{post.since4pass}}."></span>{% endif %}
    {% if post.poster_hash %}<span class="posteruid id_{{post.poster_hash}}">(ID: <a title="." href="#">{{post.poster_hash}}</a>) </span>{% endif %}
    {% if post.country %}<span title="{{post.country}}{{post.country_name}}" class="flag flag-{{post.country|lower}}"></span>{% endif %}
    {% if post.troll_country %}<span title="{{post.country_name}}" class="flag-pol2 flag-{{post.troll_country|lower}}"></span>{% endif %}
    <span class="dateTime" data-utc="{{post.time}}">{{post.now}}</span>
    <span class="postNum desktop">
        {% if search_result and post.resto != 0 %}
            <a href="/{{post.board_shortname}}/thread/{{post.resto}}#p{{post.no}}">No.{{post.no}}</a>
        {% elif search_result and post.resto == 0 %}
            <a href="/{{post.board_shortname}}/thread/{{post.no}}#p{{post.no}}">No.{{post.no}}</a>
        {% else %}
            <a href="#p{{post.no}}" title="Link to this post">No. {{post.no}}</a>
        {% endif %}
        {% if post.resto == 0 %}
            {% if post.sticky %}
                <img src="/static/images/sticky.gif" alt="Sticky" title="Sticky" class="stickyIcon retina">
            {% endif %}
            {% if post.closed %}
                <img src="/static/images/closed.gif" alt="Closed" title="Closed" class="closedIcon retina">
            {% endif %}
        {% endif %}
    </span>
    <span class="postMenuBtn" title="Post menu" data-cmd="post-menu">â–¶</span>
    {% if search_result and post.resto != 0 %}
        [<a href="/{{post.board_shortname}}/thread/{{post.resto}}#p{{post.no}}" target="_blank">View</a>]
    {% endif %}
    {% if search_result and post.resto == 0 %}
        [<a href="/{{post.board_shortname}}/thread/{{post.no}}" target="_blank">View</a>]
    {% endif %}
    {% if not search_result and post.resto == 0 %}
        {% if board_index_page %}
            [<a href="/{{post.board_shortname}}/thread/{{post.no}}" target="_blank">View</a>]
        {% endif %}
        [<a href="https://boards.4chan.org/{{ post.board_shortname }}/thread/{{ post.no }}" rel="noreferrer" target="_blank">Source</a>]
    {% endif %}
    <div id="bl_{{post.no}}" class="backlink">
        {% if quotelinks %}
            {% for quotelink in quotelinks[post.no|string] %}
                <span class="quotelink">
                    <a href="#p{{ quotelink }}" class="quotelink" data-board_shortname="{{post.board_shortname}}">&gt;&gt;{{ quotelink }}</a>
                </span>
            {% endfor %}
        {% endif %}
    </div>
</div>
{% if post.resto and post.filename %}
    <div class="file" id="f{{post.no}}">
        <div class="fileText" id="fT{{post.no}}">
            File:
            <a href="{{ get_image_src(post.board_shortname, post, thumb_uri, image_uri, prefer='image') }}" target="_blank" title="{{ post.asagi_filename}}">{{post.filename}}.{{post.ext}}</a>
            (<span title="{{post.md5}}">{% if post.spoiler %}Spoiler, {% endif %}{% if post.fsize >= 1048576 %}{{(post.fsize / 1024 / 1024 )| round(2, 'floor')}} MB, {{post.w}}x{{post.h}}){% else %}{{(post.fsize / 1024 )| round(1, 'floor') }} KB, {{post.w}}x{{post.h}}){% endif %}</span>
        </div>
        <a class="fileThumb" href="{{ get_image_src(post.board_shortname, post, thumb_uri, image_uri, prefer='image') }}" target="_blank">
            <img src="{{ get_image_src(post.board_shortname, post, thumb_uri, image_uri) }}" data-md5="{{post.md5}}" style="height: {{post.tn_h}}px; width: {{post.tn_w}}px;" class="replyImg postImg{% if post.spoiler %} spoiler{% endif %}" loading="lazy">
        </a>
    </div>
{% endif %}
<blockquote class="postMessage" id="m{{post.no}}">{{post.com|safe}}</blockquote>
</div>
</div>
